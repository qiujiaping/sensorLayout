#!/usr/bin/env python
# encoding: utf-8
'''
@author: 雨夜微凉
@contact: 1475477624@qq.com
@file: qgis_node_select.py
@time: 2020/6/28 20:25
@desc:根据算法得到的节点索引和QGIS导出的所有节点属性文件匹配得到算法得到的节点属性文件（其实可以从wntr得到），再导入到qgis当中可视化显示
'''
import pandas as pd
import wntr
def get_node(p, l):
    """
    简单的从csv的某一列中选取特定的值，重新整合成新的csv
    :param p:  pd对象
    :param l: 选取的节点list
    :return: new csv
    """
    l2 = []
    for i in l:
        n = p.loc[p["ID"] == i]  # 选取的方式
        l2.append(n)
    result = pd.concat(l2, axis=0) # 0为横向整合
    result = pd.DataFrame(result)
    result = result[["X", "Y", "ID"]] # 只要特定的列
    print(result)
    result.to_csv("node_select.csv", index=False)

def get_nodeId(inp,nodeIndexList):
    wn = wntr.network.WaterNetworkModel(inp)
    nodeID = wn.junction_name_list
    nodeIndexId = {}
    for i in range(len(nodeID)):
        nodeIndexId.update({i: nodeID[i]})
    nodeId = []
    for key in nodeIndexList:
        nodeId.append(nodeIndexId[key])
    node_select_Id = []
    # 只是为了将int改成str
    for i in nodeId:
        node_select_Id.append(str(i))
    return node_select_Id

if __name__ == "__main__":
    # a = [6, 47, 70, 72, 97, 112, 116, 124, 136, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 354, 355, 370, 371,
    #      372, 392, 436, 496, 512, 524, 546, 547, 565, 593, 594, 603, 644, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 800]
    # b = [6, 47, 70, 72, 97, 113, 116, 124, 137, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 353, 355, 370, 371,
    #      372, 391, 436, 496, 512, 524, 546, 547, 566, 593, 594, 603, 643, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 800]
    # c = [6, 47, 70, 72, 97, 113, 116, 124, 137, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 353, 355, 370, 371,
    #      372, 392, 436, 496, 512, 524, 546, 547, 565, 593, 594, 603, 643, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 800]
    # d = [6, 47, 70, 72, 97, 112, 116, 124, 136, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 354, 355, 370, 371,
    #      372, 391, 436, 496, 512, 524, 546, 547, 566, 593, 594, 603, 644, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 800]
    # e = [6, 47, 70, 72, 97, 112, 116, 124, 137, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 354, 355, 370, 371,
    #      372, 391, 436, 496, 512, 524, 546, 547, 566, 593, 594, 603, 644, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 799]
    # f = [6, 47, 70, 72, 97, 112, 116, 124, 136, 208, 225, 234, 242, 260, 295, 319, 321, 336, 352, 354, 355, 370, 371,
    #      373, 391, 436, 496, 512, 524, 546, 547, 566, 593, 594, 603, 644, 654, 657, 660, 665, 668, 676, 682, 700, 701,
    #      705, 735, 767, 780, 799]
    # g=[8,13,20,29,71,76,118,134,159,162,167,173,174,222,232,239,260,287,304,305,308,315,332,369,385,390,391,417,427,450,458,468,482,492,535,561,570,574,586,601,609,613,682,692,697,715,744,745,749,793]
    # h=[8,13,19,29,71,76,118,134,159,162,167,173,175,222,232,239,260,287,304,305,308,315,332,369,385,390,391,417,427,449,459,468,482,492,535,561,570,574,586,601,609,613,682,692,697,715,744,745,749,793]
    temp=[20,134,155,186,188,190,213,216,217,236,284,298,299,315,317,332,363,377,429,431,442,444,469,476,485,497,498,510,513,530,541,546,560,565,575,578,584,603,624,632,658,659,674,708,713,736,742,777,794,804]
    inp = r"D:\科研\code\sensorLayout\simulation\data\ky2.inp"
    xy_csv="ky2_xy.csv"
    node_select_Id=get_nodeId(inp,temp)
    p = pd.read_csv(xy_csv)
    get_node(p, node_select_Id)

